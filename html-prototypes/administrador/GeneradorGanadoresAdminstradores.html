<!DOCTYPE html>

<html class="dark" lang="es"><head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>Generación de Ganadores - Admin</title>
<!-- Google Fonts -->
<link href="https://fonts.googleapis.com" rel="preconnect"/>
<link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;900&amp;display=swap" rel="stylesheet"/>
<link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&amp;display=swap" rel="stylesheet"/>
<link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&amp;display=swap" rel="stylesheet"/>
<!-- Tailwind CSS -->
<script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
<!-- Tailwind Config -->
<script id="tailwind-config">
        tailwind.config = {
            darkMode: "class",
            theme: {
                extend: {
                    colors: {
                        "primary": "#2463eb",
                        "background-light": "#f6f6f8",
                        "background-dark": "#111621",
                        "card-dark": "#1e2433", // Slightly lighter than bg-dark for contrast
                        "border-dark": "#2a3241",
                    },
                    fontFamily: {
                        "display": ["Inter", "sans-serif"]
                    },
                    borderRadius: {"DEFAULT": "0.25rem", "lg": "0.5rem", "xl": "0.75rem", "full": "9999px"},
                },
            },
        }
    </script>
<style>
        body {
            font-family: 'Inter', sans-serif;
        }
        /* Custom scrollbar for dark theme */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #111621; 
        }
        ::-webkit-scrollbar-thumb {
            background: #2a3241; 
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #3b4657; 
        }
    </style>
</head>
<body class="bg-background-light dark:bg-background-dark text-slate-900 dark:text-white antialiased overflow-hidden">
<div class="flex h-screen w-full">
<!-- Sidebar -->
<aside class="w-64 flex-shrink-0 flex flex-col border-r border-gray-200 dark:border-border-dark bg-white dark:bg-[#151a25]">
<div class="h-16 flex items-center px-6 border-b border-gray-200 dark:border-border-dark">
<div class="flex items-center gap-2 text-primary">
<span class="material-symbols-outlined text-3xl">confirmation_number</span>
<span class="text-lg font-bold tracking-tight text-slate-900 dark:text-white">Sorteos<span class="text-primary">Admin</span></span>
</div>
</div>
<div class="flex-1 overflow-y-auto py-4 px-3 space-y-1">
<p class="px-3 text-xs font-semibold text-gray-500 uppercase tracking-wider mb-2 mt-2">Principal</p>
<a class="flex items-center gap-3 px-3 py-2.5 rounded-lg text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-white/5 hover:text-gray-900 dark:hover:text-white transition-colors group" href="DashboardAdmnistrador.html">
<span class="material-symbols-outlined group-hover:text-primary transition-colors">dashboard</span>
                    Dashboard
                </a>
<a class="flex items-center gap-3 px-3 py-2.5 rounded-lg text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-white/5 hover:text-gray-900 dark:hover:text-white transition-colors group" href="CrudGestionSorteo.html">
<span class="material-symbols-outlined group-hover:text-primary transition-colors">confirmation_number</span>
                    Gestión de Sorteos
                </a>
<a class="flex items-center gap-3 px-3 py-2.5 rounded-lg text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-white/5 hover:text-gray-900 dark:hover:text-white transition-colors group" href="ValidacionPagosAdministrador.html">
<span class="material-symbols-outlined group-hover:text-primary transition-colors">payments</span>
                    Validación de Pagos
                    <span class="ml-auto bg-yellow-500/20 text-yellow-500 text-xs font-bold px-2 py-0.5 rounded-full">3</span>
</a>
<a class="flex items-center gap-3 px-3 py-2.5 rounded-lg bg-primary/10 text-primary font-medium" href="GeneradorGanadoresAdminstradores.html">
<span class="material-symbols-outlined">emoji_events</span>
                    Generación de Ganadores
                </a>
<p class="px-3 text-xs font-semibold text-gray-500 uppercase tracking-wider mb-2 mt-6">Administración</p>
<a class="flex items-center gap-3 px-3 py-2.5 rounded-lg text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-white/5 hover:text-gray-900 dark:hover:text-white transition-colors group" href="GestionUsuariosAdministrador.html">
<span class="material-symbols-outlined group-hover:text-primary transition-colors">group</span>
                    Usuarios
                </a>
<a class="flex items-center gap-3 px-3 py-2.5 rounded-lg text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-white/5 hover:text-gray-900 dark:hover:text-white transition-colors group" href="AuditoriaAccionesAdmin.html">
<span class="material-symbols-outlined group-hover:text-primary transition-colors">settings</span>
                    Auditoría
                </a>
<a class="flex items-center gap-3 px-3 py-2.5 rounded-lg text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-white/5 hover:text-gray-900 dark:hover:text-white transition-colors group" href="InformesEstadisticasAdmin.html">
<span class="material-symbols-outlined group-hover:text-primary transition-colors">analytics</span>
                    Informes
                </a>
</div>
<div class="p-4 border-t border-gray-200 dark:border-border-dark">
<div class="flex items-center gap-3">
<div class="w-10 h-10 rounded-full bg-cover bg-center" data-alt="User profile picture" style="background-image: url('https://lh3.googleusercontent.com/aida-public/AB6AXuAfIzDdUJZk0e1bBHKOe7BG0HPanJ3nx8d9vtsJZZMiXM6ZJw9-oPch2DQWyWWrowTikKHJBUkhOyI6hUEiy_TgTGdRmm-4uDyO3KjasL500lcWogtry5HOXaJxBgDxpuT_8QBEVTnbuI4727c7c5qtPNid2CyQr0SnpyEcv2R9UEoiXiOVUH_g0RdYwYfb9u5EU5DkqEZl2oL9UW9s45D-zD3htPmEHk69TrCVPL50vnE6cDfTlcz9AJEZo7Hb8gpAhxwAxDP4SCs');"></div>
<div class="flex flex-col">
<span class="text-sm font-medium text-slate-900 dark:text-white">Admin User</span>
<span class="text-xs text-gray-500">admin@sorteos.web</span>
</div>
</div>
</div>
</aside>
<!-- Main Content -->
<main class="flex-1 flex flex-col h-full overflow-hidden bg-background-light dark:bg-background-dark relative">
<!-- Header -->
<header class="h-16 flex items-center justify-between px-6 border-b border-gray-200 dark:border-border-dark bg-white dark:bg-[#151a25]/80 backdrop-blur-md sticky top-0 z-20">
<div class="flex items-center gap-4">
<!-- Mobile menu trigger (hidden on desktop) -->
<button class="lg:hidden text-gray-500">
<span class="material-symbols-outlined">menu</span>
</button>
<h1 class="text-xl font-bold text-slate-900 dark:text-white hidden sm:block">Generación de Ganadores</h1>
</div>
<div class="flex items-center gap-4">
<div class="relative hidden md:block w-64">
<span class="absolute inset-y-0 left-0 flex items-center pl-3 text-gray-500">
<span class="material-symbols-outlined text-[20px]">search</span>
</span>
<input class="w-full bg-gray-100 dark:bg-[#1e2433] border-none rounded-lg py-2 pl-10 pr-4 text-sm text-slate-900 dark:text-white focus:ring-2 focus:ring-primary placeholder-gray-500" placeholder="Buscar sorteo, usuario..." type="text"/>
</div>
<button class="relative p-2 text-gray-500 hover:text-primary transition-colors rounded-lg hover:bg-gray-100 dark:hover:bg-white/5">
<span class="material-symbols-outlined">notifications</span>
<span class="absolute top-1.5 right-1.5 w-2 h-2 bg-red-500 rounded-full"></span>
</button>
</div>
</header>
<!-- Scrollable Content -->
<div class="flex-1 overflow-y-auto p-6 space-y-6">
<div class="max-w-[1200px] mx-auto w-full">
<!-- Breadcrumbs -->
<div class="flex flex-wrap items-center gap-2 px-4 pt-4">
<button onclick="navegarAtras()" class="text-[#9da6b9] hover:text-white transition-colors text-sm font-medium leading-normal flex items-center gap-1" title="Volver">
<span class="material-symbols-outlined !text-lg">arrow_back</span>
                            Atrás
                        </button>
<span class="text-[#9da6b9] text-sm font-medium leading-normal">|</span>
<a class="text-[#9da6b9] hover:text-white transition-colors text-sm font-medium leading-normal flex items-center gap-1" href="DashboardAdmnistrador.html">
<span class="material-symbols-outlined !text-lg">dashboard</span>
                            Dashboard
                        </a>
<span class="text-[#9da6b9] text-sm font-medium leading-normal">/</span>
<span class="text-white text-sm font-medium leading-normal">Generación de Ganadores</span>
</div>
<!-- Page Heading -->
<div class="flex flex-wrap justify-between gap-3 px-4">
<div class="flex min-w-72 flex-col gap-2">
<h1 class="text-white text-3xl md:text-4xl font-black leading-tight tracking-[-0.033em]">Generación de Ganadores</h1>
<p class="text-[#9d9db9] text-base font-normal leading-normal">Selecciona y gestiona los ganadores de los sorteos finalizados.</p>
</div>
<div class="flex items-center gap-2">
<button onclick="exportarHistorialGanadoresCSV()" class="flex items-center gap-2 bg-surface-dark hover:bg-[#34344a] text-white px-4 py-2 rounded-lg transition-colors border border-gray-700/50">
<span class="material-symbols-outlined text-[20px]">download</span>
<span class="text-sm font-medium">Exportar Reporte</span>
</button>
</div>
</div>
<!-- Filters & Search Toolbar -->
<div class="px-4 py-2 flex flex-col md:flex-row gap-4 items-start md:items-center justify-between">
<!-- Search -->
<label class="flex flex-col min-w-40 h-10 w-full md:max-w-md">
<div class="flex w-full flex-1 items-stretch rounded-lg h-full border border-[#3e3e52] focus-within:border-primary transition-colors bg-[#1e1e2d]">
<div class="text-[#9d9db9] flex bg-[#1e1e2d] items-center justify-center pl-3 rounded-l-lg border-r-0">
<span class="material-symbols-outlined !text-lg">search</span>
</div>
<input id="searchInput" class="flex w-full min-w-0 flex-1 resize-none overflow-hidden rounded-lg text-white focus:outline-0 focus:ring-0 border-none bg-[#1e1e2d] focus:border-none h-full placeholder:text-[#9d9db9] px-3 rounded-l-none border-l-0 pl-2 text-sm font-normal leading-normal" placeholder="Buscar por nombre del sorteo..." value="" style="color: rgb(255 255 255) !important; background-color: rgb(30 30 45) !important;"/>
</div>
</label>
<!-- Status Chips -->
<div class="flex gap-2 flex-wrap">
<button class="filter-btn flex h-9 items-center justify-center gap-x-2 rounded-full bg-primary/20 text-primary border border-primary/30 pl-4 pr-4 transition-all" data-filter="all" onclick="aplicarFiltro('all')">
<span class="text-sm font-medium leading-normal">Todos</span>
</button>
<button class="filter-btn flex h-9 items-center justify-center gap-x-2 rounded-full bg-surface-dark hover:bg-[#34344a] text-[#9d9db9] hover:text-white border border-[#3e3e52] pl-4 pr-4 transition-all" data-filter="pending" onclick="aplicarFiltro('pending')">
<span class="text-sm font-medium leading-normal">Pendientes</span>
</button>
<button class="filter-btn flex h-9 items-center justify-center gap-x-2 rounded-full bg-surface-dark hover:bg-[#34344a] text-[#9d9db9] hover:text-white border border-[#3e3e52] pl-4 pr-4 transition-all" data-filter="completed" onclick="aplicarFiltro('completed')">
<span class="text-sm font-medium leading-normal">Completados</span>
</button>
</div>
</div>
<!-- Raffle Cards Grid -->
<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 px-4">
<!-- Card 1: Pending Selection (High Priority) -->
<div class="raffle-card flex flex-col bg-surface-dark rounded-xl overflow-hidden border border-[#3e3e52] shadow-lg hover:border-primary/50 transition-all duration-300" data-status="pending" data-name="iPhone 15 Pro Max" data-id="1">
<div class="relative h-48 w-full bg-gray-800">
<div class="absolute inset-0 bg-cover bg-center opacity-80" data-alt="Blue abstract pattern representing technology raffle" style='background-image: url("https://lh3.googleusercontent.com/aida-public/AB6AXuAoSINFL-cpmVH_XlcaDl1cwe8PsmG6-LfZhAMp6RsoF7trtqDTRFfKk5sIXMgJrd9WBHK-DdbbMp_iBnmZAjzllvHHUYkSJAGEVjLDLCWhBv4MmI_vIZPvHHpPo2ZPCLyUqtprYR5tjtzr02_ZjfJZn5vp65sDxXmvx8VfV15Knvf7T1LqTf0Ipli9ePqiuYdYZlvM39ef-ZSkeTiOjYUZF_V_XrEbpF1MSSt0CKq1dhIInIoMF6-wEfcLAFFPqb0iMqZd4reRAEM");'></div>
<div class="absolute top-3 right-3 bg-red-500 text-white text-xs font-bold px-3 py-1 rounded-full shadow-md uppercase tracking-wide">Finalizado</div>
<div class="absolute bottom-0 left-0 w-full h-1/2 bg-gradient-to-t from-surface-dark to-transparent"></div>
</div>
<div class="p-5 flex flex-col flex-1 gap-4">
<div>
<h3 class="text-white text-xl font-bold mb-1">MacBook Pro M3 Max</h3>
<p class="text-[#9d9db9] text-sm">Sorteo #8821 • Cerrado hace 2 horas</p>
</div>
<div class="grid grid-cols-2 gap-3 py-2 border-y border-[#3e3e52]">
<div class="flex flex-col">
<span class="text-[#9d9db9] text-xs uppercase font-semibold">Boletos</span>
<span class="text-white font-medium">2,000 / 2,000</span>
</div>
<div class="flex flex-col">
<span class="text-[#9d9db9] text-xs uppercase font-semibold">Recaudado</span>
<span class="text-white font-medium">$10,000 USD</span>
</div>
</div>
<div class="mt-auto pt-2">
<button onclick="generarGanador('1', this)" class="w-full h-12 bg-primary hover:bg-blue-600 text-white font-semibold rounded-lg shadow-lg shadow-primary/20 flex items-center justify-center gap-2 transition-all transform active:scale-95 group">
<span class="material-symbols-outlined group-hover:animate-spin">autorenew</span>
                                Generar Ganador
                            </button>
<p class="text-center text-[#9d9db9] text-xs mt-3 flex items-center justify-center gap-1">
<span class="material-symbols-outlined text-sm">lock</span>
                                Selección aleatoria segura
                            </p>
</div>
</div>
</div>
<!-- Card 2: Winner Selected (Action needed) -->
<div class="raffle-card flex flex-col bg-surface-dark rounded-xl overflow-hidden border border-success/30 shadow-lg shadow-success/5" data-status="completed" data-name="Ford Mustang GT" data-id="8820">
<div class="relative h-48 w-full bg-gray-800">
<div class="absolute inset-0 bg-cover bg-center opacity-80" data-alt="Green luxury car abstract background" style='background-image: url("https://lh3.googleusercontent.com/aida-public/AB6AXuDXzkVVFwoeTbIqAEzkgAVc-PdfRWGN9CzfHgq-R-IyIpCOpJHkWsiz3_kHlhIYj37QT3BpnU6WAlltwPp1D8r0BOtxTtdt0vYN6_uxtB-FyFrbFIuNiKnwGj34v6_Wqh2xWrLJ2l04DSYYmo798YqtuEISk_CsI0yiVwzDA2HHWgbkq5m-tGpkrI_Zpa9Rp7l-O5CJMLz2EdrbSPxIzGkvBuTJgBeJW-tJ4o9n70jbKvoEvZPQILuGV59UT4vBAw67bBVa6ZNgdLE");'></div>
<div class="absolute top-3 right-3 bg-success text-white text-xs font-bold px-3 py-1 rounded-full shadow-md uppercase tracking-wide flex items-center gap-1">
<span class="material-symbols-outlined text-sm">check_circle</span>
                            Seleccionado
                         </div>
<div class="absolute bottom-0 left-0 w-full h-full bg-gradient-to-t from-surface-dark via-surface-dark/60 to-transparent"></div>
<!-- Winner Overlay Preview -->
<div class="absolute bottom-4 left-4 flex items-center gap-3">
<div class="size-12 rounded-full border-2 border-success bg-gray-700 bg-cover bg-center" data-alt="Winner profile picture" style='background-image: url("https://lh3.googleusercontent.com/aida-public/AB6AXuD_8uQxIfLXRHTf7V4hHU-WPM8q0h5LPe3yQih00baUgiGfYdj9wfffllB6qrMJ-hULBuNDkJF9YE2wmsw5qQ5Cscip8-N0u7kRU_YPGfDRz9QkxC3qFzIkzWrL3zJa60er4jCFEaxudlGlRSOHKTG0DAHpCRz0lrtj7hvh5OqLwa23lunzn-9CUkQqgTSAWYLsXmN6SAC8KTgvyhWILRBRd8t9cewmkqVO1QQgKl58L30fRR-0mtlAmW9vQwJ3jF1xxnyB3BR3TaU");'></div>
<div>
<p class="text-white font-bold text-lg leading-tight">Carlos Ruiz</p>
<p class="text-success font-medium text-sm">Ganador</p>
</div>
</div>
</div>
<div class="p-5 flex flex-col flex-1 gap-4">
<div class="flex justify-between items-start">
<div>
<h3 class="text-white text-xl font-bold mb-1">Ford Mustang GT</h3>
<p class="text-[#9d9db9] text-sm">Sorteo #8820</p>
</div>
</div>
<div class="bg-[#1e1e2d] rounded-lg p-3 border border-[#3e3e52] flex items-center justify-between">
<div class="flex flex-col">
<span class="text-[#9d9db9] text-xs">Boleto Ganador</span>
<span class="text-success text-2xl font-mono font-bold tracking-widest">#0592</span>
</div>
<div class="size-10 rounded-full bg-success/20 flex items-center justify-center text-success">
<span class="material-symbols-outlined">emoji_events</span>
</div>
</div>
<div class="mt-auto flex flex-col gap-2 pt-2">
<button onclick="anunciarGanador('8820', 'Carlos Ruiz', this)" class="w-full h-10 bg-[#34344a] hover:bg-[#3f3f5a] text-white font-medium rounded-lg border border-[#4a4a6a] flex items-center justify-center gap-2 transition-colors">
<span class="material-symbols-outlined text-sm">campaign</span>
                                Anunciar Ganador
                            </button>
<button onclick="notificarGanador('8820', 'Carlos Ruiz', this)" class="w-full h-10 bg-transparent hover:bg-white/5 text-primary font-medium rounded-lg flex items-center justify-center gap-2 transition-colors">
<span class="material-symbols-outlined text-sm">mail</span>
                                Notificar a Carlos
                            </button>
</div>
</div>
</div>
<!-- Card 3: Pending Selection -->
<div class="raffle-card flex flex-col bg-surface-dark rounded-xl overflow-hidden border border-[#3e3e52] shadow-lg hover:border-primary/50 transition-all duration-300" data-status="pending" data-name="Bono Efectivo $2,500" data-id="8819">
<div class="relative h-48 w-full bg-gray-800">
<div class="absolute inset-0 bg-cover bg-center opacity-80" data-alt="Gold coins stack abstract" style='background-image: url("https://lh3.googleusercontent.com/aida-public/AB6AXuCtQcUBS2tMBXNjknJwJnuHc3dl3WeLGU9W_SWaMPjrG_b4EBZAPEYGOu0YmHcS7RqstSdcBLWocqrp0xyThF4vlP-XqXTc11iLDyX770MQZPGI5X9aOXh2qBFE-W3vGORC0R4C5A-c-Fu6tmCuapI750DAuW1-pvoDy-SuYkM4fhSviZVjli_Pg5eRyI17TR3qgb2jezjBBXZ9pRb01XTUpZpyCH4biUhw5UpdeHGa-1FQXyZbwSBBHnzpmAuMSd2SywcyCwQUIqk");'></div>
<div class="absolute top-3 right-3 bg-red-500 text-white text-xs font-bold px-3 py-1 rounded-full shadow-md uppercase tracking-wide">Finalizado</div>
<div class="absolute bottom-0 left-0 w-full h-1/2 bg-gradient-to-t from-surface-dark to-transparent"></div>
</div>
<div class="p-5 flex flex-col flex-1 gap-4">
<div>
<h3 class="text-white text-xl font-bold mb-1">Bono Efectivo $2,500</h3>
<p class="text-[#9d9db9] text-sm">Sorteo #8819 • Cerrado ayer</p>
</div>
<div class="grid grid-cols-2 gap-3 py-2 border-y border-[#3e3e52]">
<div class="flex flex-col">
<span class="text-[#9d9db9] text-xs uppercase font-semibold">Boletos</span>
<span class="text-white font-medium">500 / 500</span>
</div>
<div class="flex flex-col">
<span class="text-[#9d9db9] text-xs uppercase font-semibold">Recaudado</span>
<span class="text-white font-medium">$5,000 USD</span>
</div>
</div>
<div class="mt-auto pt-2">
<button onclick="generarGanador('1', this)" class="w-full h-12 bg-primary hover:bg-blue-600 text-white font-semibold rounded-lg shadow-lg shadow-primary/20 flex items-center justify-center gap-2 transition-all transform active:scale-95 group">
<span class="material-symbols-outlined group-hover:animate-spin">autorenew</span>
                                Generar Ganador
                            </button>
<p class="text-center text-[#9d9db9] text-xs mt-3 flex items-center justify-center gap-1">
<span class="material-symbols-outlined text-sm">lock</span>
                                Selección aleatoria segura
                            </p>
</div>
</div>
</div>
<!-- Card 4: Upcoming/Live (Disabled State Example) -->
<div class="raffle-card flex flex-col bg-surface-dark rounded-xl overflow-hidden border border-[#3e3e52] opacity-75" data-status="pending" data-name="Kit Smart Home" data-id="8822">
<div class="relative h-48 w-full bg-gray-800 grayscale">
<div class="absolute inset-0 bg-cover bg-center opacity-60" data-alt="Smart home devices collection" style='background-image: url("https://lh3.googleusercontent.com/aida-public/AB6AXuBw3ocfkeRB5vo7w-n75WEJf1CFyeKk7qC3Il0zG_ze19TwO8pRz8MrCSApAo6oaDEEfVCGFSX11McTFqxtzsvnclH6gof9EyyKssuEz7YgKv3sAnx-zCmP-RYSQQC65dIawD0ZAVfgxVnrHSGfiCyGEXtd_bvwaxYYfhEO1TFjDDX6wlRHHrk09sn-tPfWVubrOA9jaL79-ehIBsVKfKxraQpm9bfTkXkYPk4gbv-_Xq0xlyNIzm1SVKuG0scwCfYwQHCXNlN_GgU");'></div>
<div class="absolute top-3 right-3 bg-blue-500 text-white text-xs font-bold px-3 py-1 rounded-full shadow-md uppercase tracking-wide">En Curso</div>
</div>
<div class="p-5 flex flex-col flex-1 gap-4">
<div>
<h3 class="text-white text-xl font-bold mb-1">Kit Smart Home</h3>
<p class="text-[#9d9db9] text-sm">Sorteo #8822 • Cierra en 3 días</p>
</div>
<div class="w-full bg-[#1e1e2d] rounded-full h-2.5">
<div class="bg-blue-500 h-2.5 rounded-full" style="width: 45%"></div>
</div>
<div class="flex justify-between text-xs text-[#9d9db9]">
<span>450 vendidos</span>
<span>1000 total</span>
</div>
<div class="mt-auto pt-2">
<button class="w-full h-12 bg-[#34344a] text-gray-500 font-semibold rounded-lg border border-[#3e3e52] cursor-not-allowed flex items-center justify-center gap-2" disabled="">
<span class="material-symbols-outlined">schedule</span>
                                Pendiente de cierre
                            </button>
</div>
</div>
</div>
</div>
<!-- Recent History Table -->
<div class="px-4 pb-10">
<h3 class="text-white text-xl font-bold mb-4 mt-8 flex items-center gap-2">
<span class="material-symbols-outlined text-gray-400">history</span>
                    Historial Reciente
                </h3>
<div class="w-full overflow-x-auto rounded-xl border border-[#3e3e52] bg-surface-dark">
<table class="w-full text-left text-sm text-[#9d9db9]">
<thead class="bg-[#1e1e2d] text-xs uppercase text-white font-semibold">
<tr>
<th class="px-6 py-4" scope="col">Sorteo</th>
<th class="px-6 py-4" scope="col">Fecha Sorteo</th>
<th class="px-6 py-4" scope="col">Ganador</th>
<th class="px-6 py-4" scope="col">Boleto</th>
<th class="px-6 py-4 text-right" scope="col">Estado</th>
</tr>
</thead>
<tbody class="divide-y divide-[#3e3e52]">
<tr class="hover:bg-[#2c2c3e] transition-colors">
<td class="px-6 py-4 font-medium text-white flex items-center gap-3">
<div class="size-8 rounded bg-gray-700 bg-cover bg-center" data-alt="Playstation 5 thumbnail" style='background-image: url("https://lh3.googleusercontent.com/aida-public/AB6AXuAZr1D5zOrjUxp8UFLuK8N2iGa2hvsn1m-YJewZcNVpQVlzeXp5G3kTItVuMfPxD6gOFZLep1UitkuUgMdEu7mbpQYETRk-HD2NEzMv55FkqanXElU614jEaMt-RK0JZs0DyRlnjlJU97USBReAWHL89Zzon3P-kryJSYtkwbXYaKLMtgM2I9oitvBisCVcxYSd_-FsMbQ7Oh6EO6uMQnA2AQZS3EU3XRDYjVrLYvE0ot80eUnsUZMVDQsEWes2IHE-9_yjMfipdjc");'></div>
                                    PlayStation 5 Bundle
                                </td>
<td class="px-6 py-4">20 Oct 2023</td>
<td class="px-6 py-4 flex items-center gap-2">
<div class="size-6 rounded-full bg-gray-600 bg-cover" data-alt="User avatar" style='background-image: url("https://lh3.googleusercontent.com/aida-public/AB6AXuCATjZCXwEKd8em_pykPSSfw02bYB5iHvEqcLIeCh3EmDHGHCzCR7T6vU0VLKovM5UF1AUtyDvmXGYehNpkDzS4Pl5vtcJnav3iTtvnbG1WKkyFHpsH4oMVawEX0SFOA44Mv8JOF4_OP5puF8ZsnkRSMDcdXr3tUdFLb8PbZHq8WkEAZln2WjVE0m9xoEG1JegR52kJYN5-knQUy7_5z0AYzbBJ-DYYzGQZfI3InXGXLmm94HbDGVTZL7zet6liclarOJOGy11hImU");'></div>
<span class="text-white">Maria G.</span>
</td>
<td class="px-6 py-4 font-mono text-success">#1024</td>
<td class="px-6 py-4 text-right">
<span class="inline-flex items-center rounded-md bg-green-400/10 px-2 py-1 text-xs font-medium text-green-400 ring-1 ring-inset ring-green-400/20">Entregado</span>
</td>
</tr>
<tr class="hover:bg-[#2c2c3e] transition-colors">
<td class="px-6 py-4 font-medium text-white flex items-center gap-3">
<div class="size-8 rounded bg-gray-700 bg-cover bg-center" data-alt="Travel tickets thumbnail" style='background-image: url("https://lh3.googleusercontent.com/aida-public/AB6AXuBElVBab9nMar63tUEz0rEXQ4BP60uEW1mu3KnN03SIym3G3qmvkE6SnypXnHSMMKs81ZVe-JGxAWE1VmP4OKSCZJe13webr6o259jVoRYjyQYx274Qn5TcV6ParVGeRl1QMXqbtbICOb1Qs6plf_VeaPJwAEFS5shTOxlT7khxE2eT-WWYdXhxiFT-LjK9UWz5aEtLp5JhAG4L2TXs0oNs3LKEBW-M0nGknB7KD-nKtm2lQ7W_omgj17N3fJ126x2uRdkdraoTgXc");'></div>
                                    Viaje a Cancún
                                </td>
<td class="px-6 py-4">18 Oct 2023</td>
<td class="px-6 py-4 flex items-center gap-2">
<div class="size-6 rounded-full bg-gray-600 bg-cover" data-alt="User avatar" style='background-image: url("https://lh3.googleusercontent.com/aida-public/AB6AXuBCQ5Q3pNTipDesKH35ad-QVQ8jKgDX2Oqs2zF60uk9O7Rc3HwbMLeNmG9RH-es5Teh6aQddEOyxdea9tEL2M5HEB0tLKqEUjwxhh1Q8uPBOhZVj05-lIny00LaFwtOdJanGONYm1nyLDoymO5trQE4R2c5UZk6WBmcNdsgbxg2aPxqHUc5BjXxLlNegK9XZqthKY_h871wWLgJnn9oUV2Ki_fPaRwBgKrpKXglPkTgysjT6IgnwxxOAa-V2l-vE5X2of746H_YeoM");'></div>
<span class="text-white">Roberto L.</span>
</td>
<td class="px-6 py-4 font-mono text-success">#0042</td>
<td class="px-6 py-4 text-right">
<span class="inline-flex items-center rounded-md bg-blue-400/10 px-2 py-1 text-xs font-medium text-blue-400 ring-1 ring-inset ring-blue-400/20">Anunciado</span>
</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</main>
</div>
<script>
// Estado global
let currentFilter = 'all';
let searchQuery = '';

// Historial de acciones (se puede persistir en localStorage)
let historialAcciones = [];

// Inicialización
document.addEventListener('DOMContentLoaded', function() {
    const searchInput = document.getElementById('searchInput');
    
    if (searchInput) {
        searchInput.addEventListener('input', function(e) {
            searchQuery = e.target.value.toLowerCase().trim();
            filtrarYBuscar();
        });
    }
    
    // Cargar historial desde localStorage si existe
    cargarHistorial();
    renderHistorial();
});

// Funciones de filtrado
function aplicarFiltro(filter) {
    currentFilter = filter;
    
    // Actualizar estilos de los botones
    document.querySelectorAll('.filter-btn').forEach(btn => {
        const btnFilter = btn.getAttribute('data-filter');
        if (btnFilter === filter) {
            btn.classList.add('bg-primary/20', 'text-primary', 'border-primary/30');
            btn.classList.remove('bg-surface-dark', 'text-[#9d9db9]', 'border-[#3e3e52]');
        } else {
            btn.classList.remove('bg-primary/20', 'text-primary', 'border-primary/30');
            btn.classList.add('bg-surface-dark', 'text-[#9d9db9]', 'border-[#3e3e52]');
        }
    });
    
    filtrarYBuscar();
}

function filtrarYBuscar() {
    const cards = document.querySelectorAll('.raffle-card');
    
    cards.forEach(card => {
        const status = card.getAttribute('data-status');
        const name = card.getAttribute('data-name').toLowerCase();
        
        let shouldShow = true;
        
        // Filtro por estado
        if (currentFilter !== 'all') {
            if (currentFilter === 'pending' && status !== 'pending') {
                shouldShow = false;
            } else if (currentFilter === 'completed' && status !== 'completed') {
                shouldShow = false;
            }
        }
        
        // Filtro por búsqueda
        if (shouldShow && searchQuery) {
            if (!name.includes(searchQuery)) {
                shouldShow = false;
            }
        }
        
        // Mostrar u ocultar
        if (shouldShow) {
            card.style.display = '';
        } else {
            card.style.display = 'none';
        }
    });
}

// Funciones de generación de ganadores
function generarGanador(raffleId, button) {
    const card = button.closest('.raffle-card');
    if (!card) return;
    
    const raffleName = card.getAttribute('data-name');
    const nombresAleatorios = ['Juan Pérez', 'María García', 'Carlos López', 'Ana Martínez', 'Luis Rodríguez', 'Sofía Hernández'];
    const numeroBoleto = String(Math.floor(Math.random() * 500) + 1).padStart(4, '0');
    const nombreGanador = nombresAleatorios[Math.floor(Math.random() * nombresAleatorios.length)];
    
    // Simular proceso de generación
    button.disabled = true;
    const originalHTML = button.innerHTML;
    button.innerHTML = '<span class="material-symbols-outlined animate-spin">autorenew</span> Generando...';
    
    setTimeout(() => {
        // Actualizar estado de la tarjeta
        card.setAttribute('data-status', 'completed');
        card.setAttribute('data-winner', nombreGanador);
        card.setAttribute('data-winner-ticket', numeroBoleto);
        
        // Obtener la URL de la imagen del fondo
        const bgImage = card.querySelector('.bg-cover')?.style.backgroundImage || 
                       "url('https://lh3.googleusercontent.com/aida-public/AB6AXuD_8uQxIfLXRHTf7V4hHU-WPM8q0h5LPe3yQih00baUgiGfYdj9wfffllB6qrMJ-hULBuNDkJF9YE2wmsw5qQ5Cscip8-N0u7kRU_YPGfDRz9QkxC3qFzIkzWrL3zJa60er4jCFEaxudlGlRSOHKTG0DAHpCRz0lrtj7hvh5OqLwa23lunzn-9CUkQqgTSAWYLsXmN6SAC8KTgvyhWILRBRd8t9cewmkqVO1QQgKl58L30fRR-0mtlAmW9vQwJ3jF1xxnyB3BR3TaU')";
        
        // Actualizar HTML de la tarjeta
        card.innerHTML = `
            <div class="relative h-48 w-full bg-gray-800">
                <div class="absolute inset-0 bg-cover bg-center opacity-80" style="background-image: ${bgImage};"></div>
                <div class="absolute top-3 right-3 bg-success text-white text-xs font-bold px-3 py-1 rounded-full shadow-md uppercase tracking-wide flex items-center gap-1">
                    <span class="material-symbols-outlined text-sm">check_circle</span>
                    Seleccionado
                </div>
                <div class="absolute bottom-0 left-0 w-full h-full bg-gradient-to-t from-surface-dark via-surface-dark/60 to-transparent"></div>
                <div class="absolute bottom-4 left-4 flex items-center gap-3">
                    <div class="size-12 rounded-full border-2 border-success bg-gray-700 bg-cover bg-center" 
                         style="background-image: url('https://lh3.googleusercontent.com/aida-public/AB6AXuD_8uQxIfLXRHTf7V4hHU-WPM8q0h5LPe3yQih00baUgiGfYdj9wfffllB6qrMJ-hULBuNDkJF9YE2wmsw5qQ5Cscip8-N0u7kRU_YPGfDRz9QkxC3qFzIkzWrL3zJa60er4jCFEaxudlGlRSOHKTG0DAHpCRz0lrtj7hvh5OqLwa23lunzn-9CUkQqgTSAWYLsXmN6SAC8KTgvyhWILRBRd8t9cewmkqVO1QQgKl58L30fRR-0mtlAmW9vQwJ3jF1xxnyB3BR3TaU');"></div>
                    <div>
                        <p class="text-white font-bold text-lg leading-tight">${nombreGanador}</p>
                        <p class="text-success font-medium text-sm">Ganador</p>
                    </div>
                </div>
            </div>
            <div class="p-5 flex flex-col flex-1 gap-4">
                <div class="flex justify-between items-start">
                    <div>
                        <h3 class="text-white text-xl font-bold mb-1">${raffleName}</h3>
                        <p class="text-[#9d9db9] text-sm">Sorteo #${raffleId}</p>
                    </div>
                </div>
                <div class="bg-[#1e1e2d] rounded-lg p-3 border border-[#3e3e52] flex items-center justify-between">
                    <div class="flex flex-col">
                        <span class="text-[#9d9db9] text-xs">Boleto Ganador</span>
                        <span class="text-success text-2xl font-mono font-bold tracking-widest">#${numeroBoleto}</span>
                    </div>
                    <div class="size-10 rounded-full bg-success/20 flex items-center justify-center text-success">
                        <span class="material-symbols-outlined">emoji_events</span>
                    </div>
                </div>
                <div class="mt-auto flex flex-col gap-2 pt-2">
                    <button onclick="anunciarGanador('${raffleId}', '${nombreGanador}', this)" class="w-full h-10 bg-[#34344a] hover:bg-[#3f3f5a] text-white font-medium rounded-lg border border-[#4a4a6a] flex items-center justify-center gap-2 transition-colors">
                        <span class="material-symbols-outlined text-sm">campaign</span>
                        Anunciar Ganador
                    </button>
                    <button onclick="notificarGanador('${raffleId}', '${nombreGanador}', this)" class="w-full h-10 bg-transparent hover:bg-white/5 text-primary font-medium rounded-lg flex items-center justify-center gap-2 transition-colors">
                        <span class="material-symbols-outlined text-sm">mail</span>
                        Notificar a ${nombreGanador.split(' ')[0]}
                    </button>
                </div>
            </div>
        `;
        
        card.classList.remove('border-[#3e3e52]');
        card.classList.add('border-success/30', 'shadow-success/5');
        
        mostrarNotificacion(`Ganador generado exitosamente: ${nombreGanador} - Boleto #${numeroBoleto}`, 'success');
        actualizarHistorial(raffleId, nombreGanador, 'generado', raffleName, numeroBoleto);
    }, 1500);
}

function anunciarGanador(raffleId, winnerName, button) {
    button.disabled = true;
    const originalHTML = button.innerHTML;
    button.innerHTML = '<span class="material-symbols-outlined text-sm animate-spin">autorenew</span> Anunciando...';
    
    setTimeout(() => {
        button.innerHTML = originalHTML;
        button.classList.add('opacity-50', 'cursor-not-allowed');
        button.innerHTML = '<span class="material-symbols-outlined text-sm">check_circle</span> Anunciado';
        
        mostrarNotificacion(`Ganador ${winnerName} anunciado públicamente`, 'success');
        // Obtener información del sorteo
        const card = document.querySelector(`[data-id="${raffleId}"]`);
        const raffleName = card ? card.getAttribute('data-name') : `Sorteo #${raffleId}`;
        const ticketNumber = card ? card.getAttribute('data-winner-ticket') : '';
        actualizarHistorial(raffleId, winnerName, 'anunciado', raffleName, ticketNumber);
    }, 1200);
}

function notificarGanador(raffleId, winnerName, button) {
    button.disabled = true;
    const originalHTML = button.innerHTML;
    button.innerHTML = '<span class="material-symbols-outlined text-sm animate-spin">autorenew</span> Enviando...';
    
    setTimeout(() => {
        button.innerHTML = originalHTML;
        button.disabled = false;
        
        mostrarNotificacion(`Notificación enviada a ${winnerName}`, 'success');
        // Obtener información del sorteo
        const card = document.querySelector(`[data-id="${raffleId}"]`);
        const raffleName = card ? card.getAttribute('data-name') : `Sorteo #${raffleId}`;
        const ticketNumber = card ? card.getAttribute('data-winner-ticket') : '';
        actualizarHistorial(raffleId, winnerName, 'notificado', raffleName, ticketNumber);
    }, 1000);
}

/**
 * Actualiza el historial con una nueva acción
 * @param {string} raffleId - ID del sorteo
 * @param {string} winnerName - Nombre del ganador
 * @param {string} accion - Tipo de acción: 'generado', 'anunciado', 'notificado'
 * @param {string} raffleName - Nombre del sorteo
 * @param {string} ticketNumber - Número del boleto ganador
 */
function actualizarHistorial(raffleId, winnerName, accion = 'generado', raffleName = '', ticketNumber = '') {
    // Obtener información del sorteo desde la tarjeta si no se proporciona
    const card = document.querySelector(`[data-id="${raffleId}"]`);
    if (card && !raffleName) {
        raffleName = card.getAttribute('data-name') || `Sorteo #${raffleId}`;
    }
    if (card && !ticketNumber) {
        ticketNumber = card.getAttribute('data-winner-ticket') || '';
    }
    
    // Crear entrada de historial
    const entrada = {
        id: Date.now(), // ID único basado en timestamp
        raffleId: raffleId,
        raffleName: raffleName || `Sorteo #${raffleId}`,
        fecha: new Date().toLocaleDateString('es-ES', { day: '2-digit', month: 'short', year: 'numeric' }),
        fechaCompleta: new Date().toISOString(), // Para ordenamiento
        ganador: winnerName,
        boleto: ticketNumber || 'N/A',
        estado: obtenerEstadoPorAccion(accion),
        accion: accion,
        imagen: card ? card.querySelector('.bg-cover')?.style.backgroundImage || '' : ''
    };
    
    // Agregar al inicio del array (más reciente primero)
    historialAcciones.unshift(entrada);
    
    // Limitar a las últimas 50 entradas
    if (historialAcciones.length > 50) {
        historialAcciones = historialAcciones.slice(0, 50);
    }
    
    // Guardar en localStorage
    guardarHistorial();
    
    // Actualizar la tabla
    renderHistorial();
    
    console.log('Historial actualizado:', entrada);
}

/**
 * Obtiene el estado visual según la acción
 * @param {string} accion - Tipo de acción
 * @returns {string} Estado para mostrar
 */
function obtenerEstadoPorAccion(accion) {
    const estados = {
        'generado': 'Generado',
        'anunciado': 'Anunciado',
        'notificado': 'Notificado',
        'entregado': 'Entregado'
    };
    return estados[accion] || 'Generado';
}

/**
 * Obtiene el badge de estado según la acción
 * @param {string} accion - Tipo de acción
 * @returns {string} HTML del badge
 */
function obtenerBadgeEstado(accion) {
    const badges = {
        'generado': '<span class="inline-flex items-center rounded-md bg-yellow-400/10 px-2 py-1 text-xs font-medium text-yellow-400 ring-1 ring-inset ring-yellow-400/20">Generado</span>',
        'anunciado': '<span class="inline-flex items-center rounded-md bg-blue-400/10 px-2 py-1 text-xs font-medium text-blue-400 ring-1 ring-inset ring-blue-400/20">Anunciado</span>',
        'notificado': '<span class="inline-flex items-center rounded-md bg-purple-400/10 px-2 py-1 text-xs font-medium text-purple-400 ring-1 ring-inset ring-purple-400/20">Notificado</span>',
        'entregado': '<span class="inline-flex items-center rounded-md bg-green-400/10 px-2 py-1 text-xs font-medium text-green-400 ring-1 ring-inset ring-green-400/20">Entregado</span>'
    };
    return badges[accion] || badges['generado'];
}

/**
 * Renderiza la tabla de historial
 */
function renderHistorial() {
    const tbody = document.querySelector('tbody');
    if (!tbody) return;
    
    // Si no hay historial nuevo, mantener los datos estáticos
    if (historialAcciones.length === 0) {
        return; // Mantener los datos estáticos del HTML
    }
    
    // Datos estáticos originales (para mantener algunos ejemplos si no hay suficientes datos nuevos)
    const datosEstaticos = [
        {
            raffleName: 'PlayStation 5 Bundle',
            fecha: '20 Oct 2023',
            ganador: 'Maria G.',
            boleto: '1024',
            estado: 'Entregado',
            accion: 'entregado',
            imagen: "url('https://lh3.googleusercontent.com/aida-public/AB6AXuAZr1D5zOrjUxp8UFLuK8N2iGa2hvsn1m-YJewZcNVpQVlzeXp5G3kTItVuMfPxD6gOFZLep1UitkuUgMdEu7mbpQYETRk-HD2NEzMv55FkqanXElU614jEaMt-RK0JZs0DyRlnjlJU97USBReAWHL89Zzon3P-kryJSYtkwbXYaKLMtgM2I9oitvBisCVcxYSd_-FsMbQ7Oh6EO6uMQnA2AQZS3EU3XRDYjVrLYvE0ot80eUnsUZMVDQsEWes2IHE-9_yjMfipdjc')"
        },
        {
            raffleName: 'Viaje a Cancún',
            fecha: '18 Oct 2023',
            ganador: 'Roberto L.',
            boleto: '0042',
            estado: 'Anunciado',
            accion: 'anunciado',
            imagen: "url('https://lh3.googleusercontent.com/aida-public/AB6AXuBElVBab9nMar63tUEz0rEXQ4BP60uEW1mu3KnN03SIym3G3qmvkE6SnypXnHSMMKs81ZVe-JGxAWE1VmP4OKSCZJe13webr6o259jVoRYjyQYx274Qn5TcV6ParVGeRl1QMXqbtbICOb1Qs6plf_VeaPJwAEFS5shTOxlT7khxE2eT-WWYdXhxiFT-LjK9UWz5aEtLp5JhAG4L2TXs0oNs3LKEBW-M0nGknB7KD-nKtm2lQ7W_omgj17N3fJ126x2uRdkdraoTgXc')"
        }
    ];
    
    // Combinar historial nuevo (más reciente primero) con datos estáticos
    const historialCompleto = [...historialAcciones, ...datosEstaticos];
    
    // Limitar a las 10 más recientes
    const historialMostrar = historialCompleto.slice(0, 10);
    
    tbody.innerHTML = historialMostrar.map(entrada => {
        // Obtener iniciales del ganador para avatar
        const iniciales = entrada.ganador.split(' ').map(n => n[0]).join('').substring(0, 2);
        const nombreCorto = entrada.ganador.split(' ')[0] + ' ' + (entrada.ganador.split(' ')[1]?.[0] || '');
        
        return `
            <tr class="hover:bg-[#2c2c3e] transition-colors">
                <td class="px-6 py-4 font-medium text-white flex items-center gap-3">
                    <div class="size-8 rounded bg-gray-700 bg-cover bg-center" style="${entrada.imagen ? `background-image: ${entrada.imagen};` : ''}"></div>
                    ${entrada.raffleName}
                </td>
                <td class="px-6 py-4">${entrada.fecha}</td>
                <td class="px-6 py-4 flex items-center gap-2">
                    <div class="size-6 rounded-full bg-primary/20 flex items-center justify-center text-primary text-xs font-bold border border-primary/30">
                        ${iniciales}
                    </div>
                    <span class="text-white">${nombreCorto}</span>
                </td>
                <td class="px-6 py-4 font-mono text-success">#${entrada.boleto}</td>
                <td class="px-6 py-4 text-right">
                    ${obtenerBadgeEstado(entrada.accion)}
                </td>
            </tr>
        `;
    }).join('');
}

/**
 * Guarda el historial en localStorage
 */
function guardarHistorial() {
    try {
        localStorage.setItem('historialGanadores', JSON.stringify(historialAcciones));
    } catch (e) {
        console.warn('No se pudo guardar en localStorage:', e);
    }
}

/**
 * Carga el historial desde localStorage
 */
function cargarHistorial() {
    try {
        const historialGuardado = localStorage.getItem('historialGanadores');
        if (historialGuardado) {
            historialAcciones = JSON.parse(historialGuardado);
        }
    } catch (e) {
        console.warn('No se pudo cargar desde localStorage:', e);
        historialAcciones = [];
    }
}

// ========== EXPORTACIÓN DE DATOS ==========

/**
 * Exporta el historial de ganadores a CSV con formato mejorado
 */
function exportarHistorialGanadoresCSV() {
    // Combinar historial dinámico con datos estáticos si es necesario
    const datosEstaticos = [
        { raffleName: 'Gran Rifa de Navidad', fecha: '25 Dic, 2023', ganador: 'Carlos Ruiz', boleto: '0592', accion: 'Generado', imagen: null },
        { raffleName: 'Sorteo Pro-Fondos', fecha: '30 Nov, 2023', ganador: 'Ana Sánchez', boleto: '1245', accion: 'Anunciado', imagen: null },
        { raffleName: 'Rifa de Verano', fecha: '15 Ene, 2024', ganador: 'Luis Martínez', boleto: '0891', accion: 'Notificado', imagen: null }
    ];
    
    const historialCompleto = [...historialAcciones, ...datosEstaticos];
    
    if (historialCompleto.length === 0) {
        mostrarNotificacion('No hay historial para exportar', 'error');
        return;
    }
    
    // Obtener fecha actual para el título
    const fechaActual = new Date().toLocaleDateString('es-ES', { 
        day: '2-digit', 
        month: 'long', 
        year: 'numeric',
        hour: '2-digit',
        minute: '2-digit'
    });
    
    // Preparar datos con formato mejorado
    const headers = [
        'ID Sorteo',
        'Nombre del Sorteo',
        'Fecha del Sorteo',
        'Nombre del Ganador',
        'Número de Boleto Ganador',
        'Estado',
        'Acción Realizada'
    ];
    
    const datos = historialCompleto.map((entrada, index) => {
        const accionTexto = entrada.accion === 'generado' ? 'Ganador Generado' : 
                           entrada.accion === 'anunciado' ? 'Ganador Anunciado' : 
                           entrada.accion === 'notificado' ? 'Ganador Notificado' : 
                           entrada.accion === 'entregado' ? 'Premio Entregado' :
                           entrada.accion || 'Generado';
        
        const estadoTexto = entrada.estado || accionTexto;
        
        return [
            entrada.raffleId || `SORT-${String(index + 1).padStart(4, '0')}`,
            entrada.raffleName || 'N/A',
            entrada.fecha || 'N/A',
            entrada.ganador || 'N/A',
            entrada.boleto ? `#${entrada.boleto}` : 'N/A',
            estadoTexto,
            accionTexto
        ];
    });
    
    // Crear CSV con título y formato mejorado
    const lineas = [];
    
    // Título del reporte
    lineas.push('REPORTE DE HISTORIAL DE GANADORES');
    lineas.push('');
    lineas.push(`Fecha de Generación: ${fechaActual}`);
    lineas.push(`Total de Registros: ${historialCompleto.length}`);
    lineas.push('');
    lineas.push('='.repeat(80));
    lineas.push('');
    
    // Encabezados
    lineas.push(headers.map(cell => `"${String(cell).replace(/"/g, '""')}"`).join(','));
    
    // Separador visual
    lineas.push(headers.map(() => '"-"').join(','));
    
    // Datos
    datos.forEach(row => {
        lineas.push(row.map(cell => `"${String(cell).replace(/"/g, '""')}"`).join(','));
    });
    
    // Pie de página
    lineas.push('');
    lineas.push('='.repeat(80));
    lineas.push('');
    lineas.push(`Este reporte fue generado automáticamente el ${fechaActual}`);
    lineas.push('Sistema de Gestión de Sorteos - Administración');
    
    const csv = lineas.join('\n');
    
    // Agregar BOM para Excel (UTF-8 con BOM)
    const BOM = '\uFEFF';
    const blob = new Blob([BOM + csv], { type: 'text/csv;charset=utf-8;' });
    
    // Descargar
    const link = document.createElement('a');
    link.href = URL.createObjectURL(blob);
    const nombreArchivo = `Reporte_Ganadores_${new Date().toISOString().split('T')[0]}.csv`;
    link.download = nombreArchivo;
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
    
    mostrarNotificacion(`Reporte exportado exitosamente: ${historialCompleto.length} registro(s)`, 'success');
}

// ========== NAVEGACIÓN CON HISTORIAL ==========

/**
 * Navega hacia atrás usando el historial del navegador
 */
function navegarAtras() {
    try {
        if (window.history.length > 1) {
            window.history.back();
        } else {
            window.location.href = 'DashboardAdmnistrador.html';
        }
    } catch (error) {
        console.error('Error al navegar atrás:', error);
        window.location.href = 'DashboardAdmnistrador.html';
    }
}

// Función para mostrar notificaciones
function mostrarNotificacion(mensaje, tipo = 'info') {
    const notification = document.createElement('div');
    notification.className = `fixed top-4 right-4 z-50 px-6 py-4 rounded-lg shadow-lg flex items-center gap-3 ${
        tipo === 'success' ? 'bg-green-500 text-white' : 
        tipo === 'error' ? 'bg-red-500 text-white' : 
        'bg-blue-500 text-white'
    }`;
    notification.style.opacity = '0';
    notification.style.transform = 'translateX(100%)';
    notification.style.transition = 'all 0.3s ease-in-out';
    
    notification.innerHTML = `
        <span class="material-symbols-outlined">${tipo === 'success' ? 'check_circle' : tipo === 'error' ? 'error' : 'info'}</span>
        <span class="font-medium">${mensaje}</span>
    `;

    document.body.appendChild(notification);

    setTimeout(() => {
        notification.style.opacity = '1';
        notification.style.transform = 'translateX(0)';
    }, 10);

    setTimeout(() => {
        notification.style.opacity = '0';
        notification.style.transform = 'translateX(100%)';
        setTimeout(() => notification.remove(), 300);
    }, 3000);
}
</script>
</body></html>